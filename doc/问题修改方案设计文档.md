è¿™ä¸ªé”™è¯¯éå¸¸å¸¸è§ï¼Œæ˜¯ **Next.js + Prisma éƒ¨ç½²åˆ° Vercel** æ—¶çš„å…¸å‹é—®é¢˜ã€‚
 âœ… åŸå› ç®€è¿°ï¼š

> Prisma åœ¨æœ¬åœ°å¼€å‘æ—¶ä¼šç¼–è¯‘ç”Ÿæˆä¸æœ¬åœ°ç³»ç»ŸåŒ¹é…çš„æ•°æ®åº“å¼•æ“ï¼ˆQuery Engine äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ã€‚
>  ä½† **Vercel éƒ¨ç½²ç¯å¢ƒæ˜¯åŸºäº Linuxï¼ˆrhel-openssl-3.0.xï¼‰** çš„ï¼Œè€Œæœ¬åœ°å¯èƒ½æ˜¯ macOS / Windowsï¼Œå¯¼è‡´è¿è¡Œæ—¶ Prisma Client æ‰¾ä¸åˆ°å¯¹åº”å¹³å°çš„å¼•æ“æ–‡ä»¶ã€‚

------

## ğŸ” æŠ¥é”™è¯¦æƒ…

```
Prisma Client could not locate the Query Engine for runtime "rhel-openssl-3.0.x"
```

è¯´æ˜ï¼š

- Vercel çš„è¿è¡Œç¯å¢ƒæ˜¯ **Linux (glibc + OpenSSL 3)**ï¼›
- ä½ ç”Ÿæˆçš„ Prisma Client å¹¶æœªåŒ…å«è¯¥å¹³å°çš„ Query Engineï¼›
- å› æ­¤åœ¨ Vercel è¿è¡Œæ—¶æŠ¥é”™ã€‚

------

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€ï¼ˆæ¨èï¼‰ï¼š

åœ¨æœ¬åœ°æ‰§è¡Œå‘½ä»¤æ—¶**æŒ‡å®šæ­£ç¡®çš„äºŒè¿›åˆ¶ç›®æ ‡**ï¼š

```bash
npx prisma generate --schema=prisma/schema.prisma
```

å¹¶åœ¨ `prisma/schema.prisma` ä¸­æ·»åŠ ï¼š

```prisma
generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}
```

> ğŸ’¡ è¯´æ˜ï¼š
>
> - `"native"` é€‚é…ä½ æœ¬åœ°ç³»ç»Ÿï¼›
> - `"rhel-openssl-3.0.x"` å¯¹åº” Vercel çš„è¿è¡Œç¯å¢ƒï¼›
> - Prisma ä¼šä¸ºä¸¤ä¸ªå¹³å°éƒ½ç”Ÿæˆ Query Engineã€‚

ç„¶åé‡æ–°ç”Ÿæˆå¹¶éƒ¨ç½²ï¼š

```bash
npx prisma generate
git add .
git commit -m "fix: include correct prisma binary target for vercel"
git push
```

------

### æ–¹æ¡ˆäºŒï¼ˆå¯é€‰ï¼‰ï¼š

å¦‚æœä½ ä½¿ç”¨ **Prisma CLI è‡ªåŠ¨ç”Ÿæˆ**ï¼Œå¯ä»¥åœ¨éƒ¨ç½²å‰æ‰‹åŠ¨é‡æ–°ç”Ÿæˆï¼š

```bash
npx prisma generate --binary-targets native rhel-openssl-3.0.x
```

è¿™ä¼šåœ¨ `.prisma/client` æ–‡ä»¶å¤¹ä¸­åŒ…å«æ­£ç¡®çš„ Linux è¿è¡Œæ—¶äºŒè¿›åˆ¶æ–‡ä»¶ã€‚

------

### æ–¹æ¡ˆä¸‰ï¼ˆä»…äº†è§£ï¼‰ï¼š

åœ¨ `vercel.json` æˆ– `package.json` ä¸­æ·»åŠ æ„å»ºè„šæœ¬ç¡®ä¿ Prisma åœ¨ Vercel æ„å»ºæ—¶é‡æ–°ç”Ÿæˆï¼š

#### `package.json`

```json
{
  "scripts": {
    "postinstall": "prisma generate"
  }
}
```

> è¿™æ · Vercel åœ¨å®‰è£…ä¾èµ–åä¼šè‡ªåŠ¨æ‰§è¡Œ `npx prisma generate`ï¼Œç”Ÿæˆä¸å…¶ç¯å¢ƒåŒ¹é…çš„äºŒè¿›åˆ¶ã€‚

------

## âœ… æ¨èæœ€ç»ˆç»„åˆé…ç½®

ä½ çš„ `prisma/schema.prisma` åº”ç±»ä¼¼è¿™æ ·ï¼š

```prisma
generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
```

`package.json`ï¼š

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "postinstall": "prisma generate"
  }
}
```

------

## ğŸ§  å°æç¤º

Vercel ç¯å¢ƒé€šå¸¸æ˜¯ï¼š

- Node.js: 18.x æˆ– 20.x
- OS: Linux (glibc-based)
- OpenSSL: 3.0.x
- æ‰€ä»¥ä½¿ç”¨ `"rhel-openssl-3.0.x"` æ˜¯æœ€é€šç”¨çš„é…ç½®ã€‚

------

å¦‚æœä½ æ–¹ä¾¿çš„è¯ï¼Œä¹Ÿå¯ä»¥å‘ä¸€ä¸‹ä½ çš„ï¼š

- `prisma/schema.prisma` æ–‡ä»¶å†…å®¹
- `package.json` çš„ scripts éƒ¨åˆ†
   æˆ‘å¯ä»¥å¸®ä½ ç›´æ¥æ”¹æˆå®Œå…¨å…¼å®¹ Vercel çš„ç‰ˆæœ¬ã€‚