# 数据库导入脚本使用说明

## 概述

这个导入脚本用于将 `database-export-2026-02-05T10-30-04-851Z.json` 文件中的数据导入到 SQLite 数据库 (`prisma/dev.db`) 中。

## 使用方法

### 1. 准备工作

确保项目依赖已安装：
```bash
npm install
```

### 2. 配置环境

确保 `.env` 文件存在并包含正确的数据库配置：
```
DATABASE_URL="file:./prisma/dev.db"
```

### 3. 初始化数据库

如果数据库不存在或需要重新创建：
```bash
npx prisma migrate dev --name init
```

### 4. 运行导入

```bash
npm run import-db
```

## 脚本功能

导入脚本会按以下顺序导入数据：

1. **用户数据** - 导入所有用户账户信息
2. **分类数据** - 导入用户的任务分类
3. **待办事项** - 导入具体的待办任务
4. **会话数据** - 导入用户登录会话
5. **报告数据** - 导入生成的统计报告

## 验证导入结果

导入完成后，可以通过以下方式验证：

### 方法一：使用 Prisma Studio
```bash
npx prisma studio
```
这会在浏览器中打开数据库管理界面，可以查看所有导入的数据。

### 方法二：运行导出脚本对比
```bash
npm run export-db
```
将新导入的数据重新导出，与原始JSON文件对比验证。

## 注意事项

- 导入过程使用数据库事务，确保数据一致性
- 如果导入过程中出现错误，所有更改都会回滚
- 导入前建议备份现有数据库文件
- 确保导出的JSON文件格式正确且完整

## 错误处理

常见错误及解决方案：

1. **数据库连接失败**
   - 检查 `.env` 文件中的 `DATABASE_URL` 配置
   - 确保数据库文件路径正确
   - 重新运行 `npx prisma migrate dev --name init`

2. **权限错误**
   - 确保对 `prisma/` 目录有读写权限
   - 在Windows上可能需要以管理员身份运行

3. **数据格式错误**
   - 检查JSON文件是否完整
   - 确保日期格式正确（ISO 8601格式）

## 成功示例输出

```
🚀 开始导入数据库...
✅ 成功读取导出文件

📋 开始导入数据...

👤 导入用户数据...
   ✓ 导入用户: 474960201@qq.com

📂 导入分类数据...
   ✓ 导入分类: 生活
   ✓ 导入分类: 工作
   ✓ 导入分类: 个人

📝 导入待办事项数据...
   ✓ 导入待办事项: TodoList功能优化
   ✓ 导入待办事项: TodoList样式与交互优化
   ... (共36条待办事项)

🔐 导入会话数据...
   ✓ 导入会话: cmh7mvi8...
   ... (共12条会话)

📊 导入报告数据...
   ✓ 导入报告: DAILY - cmh8z0be...
   ... (共3条报告)

✅ 数据导入完成！

📊 导入统计:
   用户: 1 条
   分类: 3 条
   待办事项: 36 条
   会话: 12 条
   报告: 3 条
```